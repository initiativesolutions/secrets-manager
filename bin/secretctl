#!/usr/bin/env php
<?php

namespace Composer;

use SecretsManager\Command\CommandInterface;
use SecretsManager\Command\Delete;
use SecretsManager\Command\Encryption;
use SecretsManager\Command\ListTokens;
use SecretsManager\Command\Rotation;
use SecretsManager\Command\CommandLine;

require_once './vendor/autoload.php';

$cli = new CommandLine($argv);
/** @var CommandInterface|null $action */
$action = null;

switch ($cli->getAction()) {
    case "rotate":
        $action = new Rotation($cli);
        break;
    case "encrypt":
        $action = new Encryption($cli);
        break;
    case "list":
        $action = new ListTokens($cli);
        break;
    case "delete":
        $action = new Delete($cli);
        break;
    case "help":
        $cli->write("help"); // todo : implement it
        break;
    default:
        $cli->error("Bad action or missing\n\t-> run : bin/secretctl help");
}

if ($action instanceof CommandInterface) {
    try {
        $action->run();
    } catch (\Exception $e) {
        $cli->error($e->getMessage());
    }
}